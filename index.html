
<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="UTF-8" />
  <title>NEMORY Calendar + AI Chat</title>
  <style>
    body { font-family: sans-serif; background: #111; color: #fff; margin: 20px; }
    #aiModal {
      display: none; position: fixed; z-index: 10000; top: 0; left: 0; width: 100%; height: 100%;
      background: rgba(0,0,0,0.75); display: none; justify-content: center; align-items: center;
    }
    .modal-content {
      max-width: 500px; width: 90%; background: #222; color: #fff;
      padding: 20px; border-radius: 10px;
    }
    .modal-buttons button {
      background: #00e676; border: none; padding: 6px 12px; border-radius: 6px;
      cursor: pointer; margin-left: 6px;
    }
    #micStatus {
      margin-top: 10px; color: #00e676; font-weight: bold; display: none;
    }
  </style>
</head>
<body>
  <label for="yearSelect">–†—ñ–∫:</label>
  <input id="yearSelect" placeholder="–†—ñ–∫" />
  <button onclick="openAIAssistant()" title="–ü–æ–≥–æ–≤–æ—Ä–∏—Ç–∏ –∑ –ø–∞–º º—è—Ç—Ç—é"
    style="margin-left:8px;padding:4px 10px;border-radius:6px;border:none;background:#00e676;color:black;font-weight:bold;cursor:pointer;">
    ü§ñ –®–Ü
  </button>

  <div id="aiModal">
    <div class="modal-content">
      <h3>ü§ñ –ü–∞–º º—è—Ç—å-–±–æ—Ç</h3>
      <p style="font-size:14px;margin-top:-10px;">–ó–∞–ø–∏—Ç–∞–π –ø—Ä–æ –±—É–¥—å-—è–∫–∏–π —Ä—ñ–∫, –¥–µ–Ω—å –∞–±–æ –∫–∞—Ç–µ–≥–æ—Ä—ñ—é</p>
      <textarea id="aiInput" placeholder="–©–æ —Ç–∏ —à—É–∫–∞—î—à?" rows="2" style="width:100%;padding:6px;border-radius:6px;margin-top:10px;"></textarea>
      <div id="micStatus">üéôÔ∏è –°–ª—É—Ö–∞—é...</div>
      <div class="modal-buttons" style="margin-top:10px;text-align:right;">
        <button onclick="closeAIAssistant()">–ó–∞–∫—Ä–∏—Ç–∏</button>
        <button onclick="runAIAssistant()">–®—É–∫–∞—Ç–∏</button>
        <button onclick="startRecognition()" title="–ì–æ–≤–æ—Ä–∏—Ç–∏">üé§</button>
      </div>
      <div id="aiResult" style="margin-top:15px;font-size:14px;line-height:1.4;"></div>
    </div>
  </div>

<script>
const months = ["–°—ñ—á–µ–Ω—å", "–õ—é—Ç–∏–π", "–ë–µ—Ä–µ–∑–µ–Ω—å", "–ö–≤—ñ—Ç–µ–Ω—å", "–¢—Ä–∞–≤–µ–Ω—å", "–ß–µ—Ä–≤–µ–Ω—å",
                "–õ–∏–ø–µ–Ω—å", "–°–µ—Ä–ø–µ–Ω—å", "–í–µ—Ä–µ—Å–µ–Ω—å", "–ñ–æ–≤—Ç–µ–Ω—å", "–õ–∏—Å—Ç–æ–ø–∞–¥", "–ì—Ä—É–¥–µ–Ω—å"];

function openAIAssistant() {
  const modal = document.getElementById("aiModal");
  modal.style.display = "flex";
}

function closeAIAssistant() {
  const modal = document.getElementById("aiModal");
  modal.style.display = "none";
  document.getElementById("aiResult").innerHTML = "";
}

function runAIAssistant() {
  const query = document.getElementById("aiInput").value.trim().toLowerCase();
  const result = document.getElementById("aiResult");
  if (!query) {
    result.textContent = "–ë—É–¥—å –ª–∞—Å–∫–∞, –≤–≤–µ–¥–∏ –∑–∞–ø–∏—Ç.";
    return;
  }

  let responses = [];
  for (let i = 0; i < localStorage.length; i++) {
    const key = localStorage.key(i);
    if (/^\d{4}-\d{1,2}-\d{1,2}$/.test(key)) {
      const data = JSON.parse(localStorage.getItem(key));
      const [year, month, day] = key.split("-");
      const dateStr = `${parseInt(day)} ${months[parseInt(month)-1]} ${year}`;
      const cats = (data.cats || []).join(", ");
      const fullText = `${dateStr}: "${data.text || ''}" [${cats}]`.toLowerCase();

      if (fullText.includes(query)) {
        responses.push(`üß† ${dateStr}: "${data.text || '‚Äî'}" <i>${cats}</i>`);
      }
    }
  }

  if (responses.length > 0) {
    result.innerHTML = "<b>–ó–Ω–∞–π–¥–µ–Ω–æ:</b><br>" + responses.join("<br><br>");
  } else {
    result.innerHTML = "–ù—ñ—á–æ–≥–æ –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ...";
  }
}

let recognition;
function startRecognition() {
  const status = document.getElementById("micStatus");
  status.style.display = "none";

  if (!('webkitSpeechRecognition' in window)) {
    alert("‚ùå –¶–µ–π –±—Ä–∞—É–∑–µ—Ä –Ω–µ –ø—ñ–¥—Ç—Ä–∏–º—É—î –≥–æ–ª–æ—Å–æ–≤–µ –≤–≤–µ–¥–µ–Ω–Ω—è.");
    return;
  }

  recognition = new webkitSpeechRecognition();
  recognition.lang = "uk-UA";
  recognition.continuous = false;
  recognition.interimResults = false;

  recognition.onstart = () => {
    status.style.display = "block";
    status.textContent = "üéôÔ∏è –°–ª—É—Ö–∞—é...";
  };

  recognition.onend = () => {
    status.style.display = "none";
  };

  recognition.onresult = function(event) {
    const transcript = event.results[0][0].transcript;
    document.getElementById("aiInput").value = transcript;
  };

  recognition.onerror = function(event) {
    status.style.display = "none";
    let msg = "–ü–æ–º–∏–ª–∫–∞ –º—ñ–∫—Ä–æ—Ñ–æ–Ω–∞: ";
    switch(event.error) {
      case "not-allowed": msg += "–î–æ—Å—Ç—É–ø –¥–æ –º—ñ–∫—Ä–æ—Ñ–æ–Ω–∞ –∑–∞–±–æ—Ä–æ–Ω–µ–Ω–æ."; break;
      case "no-speech": msg += "–ù–µ –≤–¥–∞–ª–æ—Å—è —Ä–æ–∑–ø—ñ–∑–Ω–∞—Ç–∏ –º–æ–≤—É."; break;
      case "audio-capture": msg += "–ú—ñ–∫—Ä–æ—Ñ–æ–Ω –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ."; break;
      default: msg += event.error;
    }
    alert(msg);
  };

  recognition.start();
}
</script>
</body>
</html>
